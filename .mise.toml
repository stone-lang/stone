[env]
# Find LLVM: try Homebrew first, then system package location, then mise, then empty
LLVM_PREFIX = "{{exec(command='brew --prefix llvm 2>/dev/null || { [ -d /usr/lib/llvm-21 ] && echo /usr/lib/llvm-21; } || mise where llvm 2>/dev/null || echo')}}"
_.path = ["{{env.LLVM_PREFIX}}/bin"]
DYLD_LIBRARY_PATH = "{{env.LLVM_PREFIX}}/lib{% if env.DYLD_LIBRARY_PATH %}:{{env.DYLD_LIBRARY_PATH}}{% endif %}"
LLVM_CONFIG = "{{env.LLVM_PREFIX}}/bin/llvm-config"

[hooks]
# Ensure LLVM 21.x and lld are installed via Homebrew
preinstall = '''
    if ! brew list llvm &>/dev/null || ! brew info llvm | grep -q "21\."; then
        brew install llvm || brew upgrade llvm
    fi
    brew install --quiet lld
'''
